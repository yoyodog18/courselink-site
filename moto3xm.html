<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Interactive Session</title>
  <style>
    body {
      margin: 0;
      background-color: #000;
      color: white;
      font-family: sans-serif;
    }

    #optionPopup {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.95);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 10;
      padding: 2rem;
      text-align: center;
    }

    #optionPopup h2 {
      margin-bottom: 1rem;
      font-size: 1.6rem;
    }

    #optionPopup p {
      font-size: 0.95rem;
      color: #ccc;
      max-width: 400px;
      margin-bottom: 2rem;
    }

    .button-group {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      justify-content: center;
    }

    button {
      padding: 0.6rem 1.4rem;
      font-size: 1rem;
      background: #007bff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      color: white;
    }

    iframe {
      border: none;
      width: 100vw;
      height: 100vh;
      display: none;
    }
  </style>
</head>
<body>

  <!-- Startup Options -->
  <div id="optionPopup">
    <h2>Choose How to Play</h2>
    <p>
      Some school monitoring systems (like Hapara) can detect repetitive keyboard inputs such as arrow keys or WASD.
      If your school uses tools like these, we recommend using the offline version to avoid being flagged or blocked.
    </p>
    <div class="button-group">
      <button id="playBrowser">Play in Browser</button>
      <button id="downloadOffline">Play Offline</button>
    </div>
  </div>

  <!-- Game -->
  <iframe id="gameFrame" src=""></iframe>

  <script>
    const iframe = document.getElementById('gameFrame');
    const popup = document.getElementById('optionPopup');

    document.getElementById('playBrowser').onclick = () => {
      popup.style.display = 'none';
      iframe.src = "https://bobydob.github.io/JSEngine/build/m3m/";
      iframe.style.display = 'block';
    };

    document.getElementById('downloadOffline').onclick = () => {
      const htmlContent = `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, shrink-to-fit=no" />
  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/Rabbibo/moto@35b09901c725d990145f7b305cbcb42ddcee4782/assets/css/app.css"
    type="text/css" />
</head>
<body>
  <div id="content"></div>
  <div id="orientation"></div>
  <div id="loader">Loading ...</div>
  <script src="https://imasdk.googleapis.com/js/sdkloader/ima3.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/Stypical/lacklack@0959ed15fc96078cbb053e4e3c259a62b3e9e296/motox3m/assets/lib/nape.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/Stypical/lacklack@0959ed15fc96078cbb053e4e3c259a62b3e9e296/motox3m/assets/lib/jquery-3.1.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/Stypical/lacklack@0959ed15fc96078cbb053e4e3c259a62b3e9e296/motox3m/assets/lib/easeljs-0.8.2.combined.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/Stypical/lacklack@0959ed15fc96078cbb053e4e3c259a62b3e9e296/motox3m/assets/lib/bluebird.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/bobydob/JSEngine@0e96212fb7b2e7aa0a310d3ebe3a8ab01a114b4b/build/m3m/m3m.min.js"></script>
</body>
</html>`;

      const blob = new Blob([htmlContent], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "Moto_X3M_Offline.html";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    };
  </script>
</body>
</html>
